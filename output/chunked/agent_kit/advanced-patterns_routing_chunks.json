{
  "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
  "title": "##### Get Started",
  "num_chunks": 13,
  "total_chars": 9222,
  "chunks": [
    {
      "index": 0,
      "text": "Get Started\n- [Overview](\\overview)\n- [Quick start](\\getting-started\\quick-start)\n- [Installation](\\getting-started\\installation)\n- [Local development](\\getting-started\\local-development)",
      "char_count": 187,
      "token_count": 47,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 47,
        "has_context": true
      }
    },
    {
      "index": 1,
      "text": "Concepts\n- [Agents](\\concepts\\agents)\n- [Tools](\\concepts\\tools)\n- [Networks](\\concepts\\networks)\n- [State](\\concepts\\state)\n- [Routers](\\concepts\\routers)\n- [History](\\concepts\\history)\n- [Memory](\\concepts\\memory)\n- [Models](\\concepts\\models)\n- [Deployment](\\concepts\\deployment)",
      "char_count": 281,
      "token_count": 95,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 95,
        "has_context": true
      }
    },
    {
      "index": 2,
      "text": "Streaming\n- [Overview](\\streaming\\overview)\n- [Usage Guide](\\streaming\\usage-guide)\n- [Events](\\streaming\\events)\n- [Transport](\\streaming\\transport)\n- [Provider](\\streaming\\provider)",
      "char_count": 183,
      "token_count": 54,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 54,
        "has_context": true
      }
    },
    {
      "index": 3,
      "text": "Advanced Patterns\n- [Deterministic state routing](\\advanced-patterns\\routing)\n- [MCP as tools](\\advanced-patterns\\mcp)\n- [Human in the Loop](\\advanced-patterns\\human-in-the-loop)\n- [Multi-steps tools](\\advanced-patterns\\multi-steps-tools)\n- [Configuring Retries](\\advanced-patterns\\retries)\n- [Configuring Multi-tenancy](\\advanced-patterns\\multitenancy)\n- [UI Streaming with useAgent](\\advanced-patterns\\legacy-ui-streaming)",
      "char_count": 424,
      "token_count": 117,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 117,
        "has_context": true
      }
    },
    {
      "index": 4,
      "text": "Guided Tour\n- [The three levels of AI apps](\\guided-tour\\overview)\n- [1. Explaining a given code file](\\guided-tour\\ai-workflows)\n- [2. Complex code analysis](\\guided-tour\\agentic-workflows)\n- [3. Autonomous Bug Solver](\\guided-tour\\ai-agents)",
      "char_count": 243,
      "token_count": 75,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 75,
        "has_context": true
      }
    },
    {
      "index": 5,
      "text": "Integrations\n- [E2B - Sandboxes for AI Agents](\\integrations\\e2b)\n- [Browserbase - AI Browsers](\\integrations\\browserbase)\n- [Smithery - MCP Registry](\\integrations\\smithery)\nclose\nOn this page\n- [Core Concepts](#core-concepts)\n- [Benefits](#benefits)\n- [Implementation Structure](#implementation-structure)\n- [Execution Flow](#execution-flow)\n- [Best Practices](#best-practices)\n- [Error Handling](#error-handling)\nAdvanced Patterns",
      "char_count": 433,
      "token_count": 119,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 119,
        "has_context": true
      }
    },
    {
      "index": 6,
      "text": "Deterministic state routing\nState based routing in Agent Networks\nState based routing is a deterministic approach to managing agent workflows, allowing for more reliable, testable, and maintainable AI agent systems. This documentation covers the core concepts and implementation details based on the Inngest AgentKit framework.",
      "char_count": 327,
      "token_count": 58,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 58,
        "has_context": true
      }
    },
    {
      "index": 7,
      "text": "Deterministic state routing\nCore Concepts\nState based routing models agent workflows as a state machine where:\n- Each agent has a specific goal within a larger network\n- The network combines agents to achieve an overall objective, with shared state modified by each agent\n- The network's router inspects state and determines which agent should run next\n- The network runs in a loop, calling the router on each iteration until all goals are met\n- Agents run with updated conversation history and state on each loop iteration",
      "char_count": 523,
      "token_count": 100,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 100,
        "has_context": true
      }
    },
    {
      "index": 8,
      "text": "Deterministic state routing\nBenefits\nUnlike fully autonomous agents that rely on complex prompts to determine their own actions, state based routing:\n- Makes agent behavior more predictable\n- Simplifies testing and debugging\n- Allows for easier identification of failure points\n- Provides clear separation of concerns between agents",
      "char_count": 332,
      "token_count": 57,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 57,
        "has_context": true
      }
    },
    {
      "index": 9,
      "text": "Deterministic state routing\nImplementation Structure\nA state based routing system consists of:\n1. State Definition\nDefine structured data that represents the current progress of your workflow:\nCopy Ask AI\n```\nexport interface AgentState {\n// files stores all files that currently exist in the repo.\nfiles ?: string [];\n\n// plan is the plan created by the planning agent.  It is optional\n// as, to begin with, there is no plan.  This is set by the planning\n// agent's tool.\nplan ?: {\nthoughts : string ;\nplan_details : string ;\nedits : Array <{\nfilename : string ;\nidea : string ;\nreasoning : string ;\n}>;\n},\n\n// done indicates whether we're done editing files, and terminates the\n// network when true.\ndone : boolean ;\n}\n```\n1. Network and router implementation\nCreate a router function that inspects state and returns the appropriate agent:\nCopy Ask AI\n```\nexport const codeWritingNetwork = createNetwork < AgentState >({\nname: \"Code writing network\" ,\nagents: [], // We'll add these soon.\nrouter : ({ network }) : Agent | undefined => {\n// The router inspects network state to figure out which agent to call next.\n\nif ( network . state . data . done ) {\n// We're done editing.  This is set when the editing agent finishes\n// implementing the plan.\n//\n// At this point, we could hand off to another agent that tests, critiques,\n// and validates the edits.  For now, return undefined to signal that\n// the network has finished.\nreturn ;\n}\n\n// By default, there is no plan and we should use the planning agent to read and\n// understand files.  The planning agent's `create_plan` tool modifies state once\n// it's gathered enough context, which will then cause the router loop to pass\n// to the editing agent below.\nif ( network . state . data . plan === undefined ) {\nreturn planningAgent ;\n}\n\n// There is a plan, so switch to the editing agent to begin implementing.\n//\n// This lets us separate the concerns of planning vs editing, including using differing\n// prompts and tools at various stages of the editing process.\nreturn editingAgent ;\n}\n}\n```\nA router has the following definition:\nCopy Ask AI\n```\n// T represents the network state's type.\ntype RouterFunction < T > = ( args : {\ninput : string ;\nnetwork : NetworkRun < T >;\nstack : Agent < T >[];\ncallCount : number ;\nlastResult ?: InferenceResult ;\n}) => Promise < Agent < T > | undefined >;\n```\nThe router has access to:\n- `input` : The original input string passed to the network\n- `network` : The current network run instance with state\n- `stack` : Array of pending agents to be executed\n- `callCount` : Number of agent invocations made\n- `lastResult` : The most recent inference result from the last agent execution\n1. Agent Definition\nDefine agents with specific goals and tools.  Tools modify the network's state.  For example, a classification agent\nmay have a tool which updates the state's\n```\nclassification\n```\nproperty, so that in the next network loop we can\ndetermine which new agent to run for the classified request.\nCopy Ask AI\n```\n// This agent accepts the network state's type, so that tools are properly typed and can\n// modify state correctly.\nexport const planningAgent = createAgent < AgentState >({\nname: \"Planner\" ,\ndescription: \"Plans the code to write and which files should be edited\" ,\ntools: [\nlistFilesTool ,\n\ncreateTool ({\nname: \"create_plan\" ,\ndescription:\n\"Describe a formal plan for how to fix the issue, including which files to edit and reasoning.\" ,\nparameters: z . object ({\nthoughts: z . string (),\nplan_details: z . string (),\nedits: z . array (\nz . object ({\nfilename: z . string (),\nidea: z . string (),\nreasoning: z . string (),\n})\n),\n}),\n\nhandler : async ( plan , opts : Tool . Options < AgentState >) => {\n// Store this in the function state for introspection in tracing.\nawait opts . step ?. run ( \"plan created\" , () => plan );\nif ( opts . network ) {\nopts . network . state . data . plan = plan ;\n}\n},\n}),\n],\n\n// Agent prompts can also inspect network state and conversation history.\nsystem : ({ network }) => `\nYou are an expert Python programmer working on a specific project: ${ network ?. state . data . repo } .\n\nYou are given an issue reported within the project.  You are planning how to fix the issue by investigating the report,\nthe current code, then devising a \"plan\" - a spec - to modify code to fix the issue.\n\nYour plan will be worked on and implemented after you create it.   You MUST create a plan to\nfix the issue.  Be thorough. Think step-by-step using available tools.\n\nTechniques you may use to create a plan:\n- Read entire files\n- Find specific classes and functions within a file\n` ,\n});\n```",
      "char_count": 4620,
      "token_count": 1060,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 1060,
        "has_context": true
      }
    },
    {
      "index": 10,
      "text": "Deterministic state routing\nExecution Flow\nWhen the network runs:\n- The network router inspects the current state\n- It returns an agent to run based on state conditions (or undefined to quit)\n- The agent executes with access to previous conversation history, current state, and tools\n- Tools update the state with new information\n- The router runs again with updated state and conversation history\n- This continues until the router returns without an agent (workflow complete)",
      "char_count": 476,
      "token_count": 92,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 92,
        "has_context": true
      }
    },
    {
      "index": 11,
      "text": "Deterministic state routing\nBest Practices\n- **Keep agent goals focused and specific** : Each agent should have a specific goal, and your network should combine agents to solve a larger problem. This makes agents easy to design and test, and it makes routing logic far easier.\n- **Design state to clearly represent workflow progress** : Moving state out of conversation history and into structured data makes debugging agent workflows simple.\n- **Use tools to update state in a structured way** : Tools allow you to extract structured data from agents and modify state, making routing easy.\n- **Implement iteration limits to prevent infinite loops** : The router has a `callCount` parameter allowing you to quit early.",
      "char_count": 718,
      "token_count": 138,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 138,
        "has_context": true
      }
    },
    {
      "index": 12,
      "text": "Deterministic state routing\nError Handling\nWhen deployed to\n[Inngest](https://www.inngest.com/)\n, AgentKit provides built-in error handling:\n- Automatic retries for failed agent executions\n- State persistence between retries\n- Ability to inspect state at any point in the workflow\n- Tracing capabilities for debugging\n[Provider Previous](\\streaming\\provider)\n[MCP as tools Next](\\advanced-patterns\\mcp)\nâŒ˜ I\nAssistant Responses are generated using AI and may contain mistakes.",
      "char_count": 475,
      "token_count": 105,
      "metadata": {
        "title": "##### Get Started",
        "source": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "chunk_method": "hybrid",
        "file_path": "Docs\\agent_kit\\advanced-patterns_routing.md",
        "file_name": "advanced-patterns_routing.md",
        "file_size": 9578,
        "file_format": ".md",
        "mime_type": "text/markdown",
        "sha256_hash": "4822d2e61fb9a8e2062f95ddde8925192b2b9e751cf0c9006f0d8b1b6c2471ab",
        "author": null,
        "created_at": "2025-10-12T23:51:14.684483",
        "modified_at": "2025-10-12T23:51:14.685124",
        "page_count": null,
        "word_count": 1426,
        "extracted_at": "2025-10-13T19:59:17.643362",
        "processing_method": "markdown_docling",
        "custom_metadata": {},
        "total_chunks": 13,
        "token_count": 105,
        "has_context": true
      }
    }
  ]
}